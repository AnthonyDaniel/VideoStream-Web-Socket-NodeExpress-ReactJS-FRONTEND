(this["webpackJsonpthony-video"]=this["webpackJsonpthony-video"]||[]).push([[0],{100:function(e,t,a){"use strict";a.r(t);var n=a(0),o=a.n(n),c=a(45),s=a(8),i=a(12),r=a(13),l=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],t=arguments.length>1?arguments[1]:void 0;return"ADD_ROOM"===t.type?Object(r.a)(new Set([].concat(Object(r.a)(e),[t.room]))):e},d=function(){var e=!(arguments.length>0&&void 0!==arguments[0])||arguments[0],t=arguments.length>1?arguments[1]:void 0;return"SET_AUDIO"===t.type?t.audio:e},u=function(){var e=!(arguments.length>0&&void 0!==arguments[0])||arguments[0],t=arguments.length>1?arguments[1]:void 0;return"SET_VIDEO"===t.type?t.video:e},m=Object(i.b)({rooms:l,video:u,audio:d}),h=localStorage.getItem("reduxState")?JSON.parse(localStorage.getItem("reduxState")):{rooms:[],video:!0,audio:!0},p=Object(i.c)(m,h);p.subscribe((function(){return localStorage.setItem("reduxState",JSON.stringify(p.getState()))}));var v=p,g=a(103),f=a(104),b=a(105),E=a(6),w=a(7),y=a(2),k=a(10),N=a(9),O=a(1),S=a(102),j=a(48),D=a.n(j),C=Object(s.b)((function(e){return{rooms:e.rooms}}))((function(e){return o.a.createElement("div",{className:"content-fluid"},o.a.createElement("div",{className:"row"},o.a.createElement("div",{className:"col-6",hidden:!0},o.a.createElement("h1",{className:"title"},"ThonyVideo"),o.a.createElement("p",null,"Por favor crea un nombre de sala"),o.a.createElement("input",{type:"text",name:"room",value:e.roomId,onChange:e.handleChange,pattern:"^\\w+$",maxLength:"10",required:!0,autoFocus:!0,title:"El nombre de la sala solo debe contener letras o n\xfameros"}),o.a.createElement(S.a,{className:"primary-button",to:"/r/"+e.roomId},"Unirse"),o.a.createElement(S.a,{className:"primary-button",to:"/r/"+e.defaultRoomId},"Aleatorio"),0!==e.rooms.length&&o.a.createElement("div",null,"Salas usadas recientemente:"),e.rooms.map((function(e){return o.a.createElement(S.a,{key:e,className:"recent-room",to:"/r/"+e},e)}))),o.a.createElement("div",{className:"col-12"},o.a.createElement("div",{className:"container-fluid"},o.a.createElement("div",{className:"row justify-content-center"},o.a.createElement("div",{className:"col-12 col-sm-7 col-md-6 col-xl-5"},o.a.createElement("div",{className:""},o.a.createElement("div",{className:"container h-100"},o.a.createElement("div",{className:"d-flex justify-content-center h-100"},o.a.createElement("div",{className:"user_card"},o.a.createElement("div",{className:"container-fluid"},o.a.createElement("div",{className:"row justify-content-center"},o.a.createElement("div",{className:"col-6"},o.a.createElement("img",{src:D.a,className:"img-fluid"})))),o.a.createElement("div",{className:"d-flex justify-content-center form_container mt-0"},o.a.createElement("h4",{className:"text-center title mt-0 pt-0"},"ThonyVideo")),o.a.createElement("div",{className:"d-flex justify-content-center"},o.a.createElement("br",null),o.a.createElement("div",{className:"container-fluid"},o.a.createElement("div",{className:"row"},o.a.createElement("div",{className:"col-12"},o.a.createElement("input",{className:"form-control",type:"text",name:"room",value:e.roomId,onChange:e.handleChange,pattern:"^\\w+$",maxLength:"10",required:!0,autoFocus:!0,placeholder:"Conectate a una sala o crea una"})),o.a.createElement("div",{className:"col-12"},o.a.createElement(S.a,{className:"btn btn-primary btn-block",to:"/r/"+e.roomId},"Crear o Unirse")),o.a.createElement("div",{className:"col-6",hidden:!0},o.a.createElement(S.a,{className:"btn btn-primary btn-block",to:"/r/"+e.defaultRoomId},"Aleatorio")))))))))))))))})),I=function(e){Object(k.a)(a,e);var t=Object(N.a)(a);function a(e){var n;return Object(E.a)(this,a),(n=t.call(this,e)).defaultRoomId=String(new Date-(new Date).setHours(0,0,0,0)),n.state={roomId:n.defaultRoomId},n.handleChange=n.handleChange.bind(Object(y.a)(n)),n}return Object(w.a)(a,[{key:"handleChange",value:function(e){this.setState({roomId:e.target.value})}},{key:"render",value:function(){return o.a.createElement(C,{defaultRoomId:this.defaultRoomId,roomId:this.state.roomId,handleChange:this.handleChange})}}]),a}(n.Component);I.contextTypes={router:O.PropTypes.object};var x=I,M=function(e){Object(k.a)(a,e);var t=Object(N.a)(a);function a(e){var n;return Object(E.a)(this,a),(n=t.call(this,e)).state={bridge:"",user:""},n.onRemoteHangup=n.onRemoteHangup.bind(Object(y.a)(n)),n.onMessage=n.onMessage.bind(Object(y.a)(n)),n.sendData=n.sendData.bind(Object(y.a)(n)),n.setupDataHandlers=n.setupDataHandlers.bind(Object(y.a)(n)),n.setDescription=n.setDescription.bind(Object(y.a)(n)),n.sendDescription=n.sendDescription.bind(Object(y.a)(n)),n.hangup=n.hangup.bind(Object(y.a)(n)),n.init=n.init.bind(Object(y.a)(n)),n.setDescription=n.setDescription.bind(Object(y.a)(n)),n}return Object(w.a)(a,[{key:"componentWillMount",value:function(){window.RTCPeerConnection=window.RTCPeerConnection||window.webkitRTCPeerConnection,this.props.media(this)}},{key:"componentDidMount",value:function(){var e=this;this.props.getUserMedia.then((function(t){return e.localVideo.srcObject=e.localStream=t})),this.props.socket.on("message",this.onMessage),this.props.socket.on("hangup",this.onRemoteHangup)}},{key:"componentWillUnmount",value:function(){this.props.media(null),void 0!==this.localStream&&this.localStream.getVideoTracks()[0].stop(),this.props.socket.emit("leave")}},{key:"onRemoteHangup",value:function(){this.setState({user:"host",bridge:"host-hangup"})}},{key:"onMessage",value:function(e){"offer"===e.type?(this.pc.setRemoteDescription(new RTCSessionDescription(e)),this.pc.createAnswer().then(this.setDescription).then(this.sendDescription).catch(this.handleError)):"answer"===e.type?this.pc.setRemoteDescription(new RTCSessionDescription(e)):"candidate"===e.type&&this.pc.addIceCandidate(new RTCIceCandidate({sdpMLineIndex:e.mlineindex,candidate:e.candidate}))}},{key:"sendData",value:function(e){this.dc.send(JSON.stringify(e))}},{key:"setupDataHandlers",value:function(){var e=this;this.dc.onmessage=function(e){var t=JSON.parse(e.data);console.log("received message over data channel:"+t)},this.dc.onclose=function(){e.remoteStream.getVideoTracks()[0].stop(),console.log("The Data Channel is Closed")}}},{key:"setDescription",value:function(e){this.pc.setLocalDescription(e)}},{key:"sendDescription",value:function(){this.props.socket.send(this.pc.localDescription)}},{key:"hangup",value:function(){this.setState({user:"guest",bridge:"guest-hangup"}),this.pc.close(),this.props.socket.emit("leave")}},{key:"handleError",value:function(e){console.log(e)}},{key:"init",value:function(){var e=this;this.pc=new RTCPeerConnection({iceServers:[{url:"stun:stun.l.google.com:19302"}]}),this.pc.onicecandidate=function(t){console.log(t,"onicecandidate"),t.candidate&&e.props.socket.send({type:"candidate",mlineindex:t.candidate.sdpMLineIndex,candidate:t.candidate.candidate})},this.pc.onaddstream=function(t){console.log("onaddstream",t),e.remoteStream=t.stream,e.remoteVideo.srcObject=e.remoteStream=t.stream,e.setState({bridge:"established"})},this.pc.ondatachannel=function(t){e.dc=t.channel,e.setupDataHandlers(),e.sendData({peerMediaStream:{video:e.localStream.getVideoTracks()[0].enabled}})},this.localStream.getTracks().forEach((function(t){return e.pc.addTrack(t,e.localStream)})),"host"===this.state.user&&this.props.getUserMedia.then((function(){e.dc=e.pc.createDataChannel("chat"),e.setupDataHandlers(),console.log("attachMediaIfReady"),e.pc.createOffer().then(e.setDescription).then(e.sendDescription).catch(e.handleError)}))}},{key:"render",value:function(){var e=this;return o.a.createElement("div",{className:"media-bridge ".concat(this.state.bridge)},o.a.createElement("video",{className:"remote-video",ref:function(t){return e.remoteVideo=t},autoPlay:!0}),o.a.createElement("video",{className:"local-video",ref:function(t){return e.localVideo=t},autoPlay:!0,muted:!0}))}}]),a}(n.Component),V=a(49),H=document.documentElement;document.fullscreenEnabled=document.fullscreenEnabled||document.webkitFullscreenEnabled||document.mozFullScreenEnabled||document.msFullscreenEnabled,document.exitFullscreen=document.exitFullscreen||document.webkitExitFullscreen||document.mozCancelFullScreen||document.msExitFullscreen,H.requestFullscreen=H.requestFullscreen||H.webkitRequestFullscreen||H.mozRequestFullScreen||H.msRequestFullScreen;var R=function(){document.fullscreenEnabled&&(document.fullscreenElement||document.webkitFullscreenElement||document.mozFullScreenElement||document.msFullscreenElement?document.exitFullscreen():H.requestFullscreen())},T=function(e){return o.a.createElement("div",{className:"auth"},o.a.createElement("div",{className:"media-controls"},o.a.createElement(S.a,{className:"call-exit-button",to:"/"},o.a.createElement("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 36 36",className:"svg"},o.a.createElement("path",{d:"M30 16.5h-18.26l8.38-8.38-2.12-2.12-12 12 12 12 2.12-2.12-8.38-8.38h18.26v-3z",fill:"white"}))),o.a.createElement("button",{onClick:e.toggleAudio,className:"audio-button-"+e.audio},o.a.createElement("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 50 50",className:"svg"},o.a.createElement("path",{className:"on",d:"M38 22h-3.4c0 1.49-.31 2.87-.87 4.1l2.46 2.46C37.33 26.61 38 24.38 38 22zm-8.03.33c0-.11.03-.22.03-.33V10c0-3.32-2.69-6-6-6s-6 2.68-6 6v.37l11.97 11.96zM8.55 6L6 8.55l12.02 12.02v1.44c0 3.31 2.67 6 5.98 6 .45 0 .88-.06 1.3-.15l3.32 3.32c-1.43.66-3 1.03-4.62 1.03-5.52 0-10.6-4.2-10.6-10.2H10c0 6.83 5.44 12.47 12 13.44V42h4v-6.56c1.81-.27 3.53-.9 5.08-1.81L39.45 42 42 39.46 8.55 6z",fill:"white"}),o.a.createElement("path",{className:"off",d:"M24 28c3.31 0 5.98-2.69 5.98-6L30 10c0-3.32-2.68-6-6-6-3.31 0-6 2.68-6 6v12c0 3.31 2.69 6 6 6zm10.6-6c0 6-5.07 10.2-10.6 10.2-5.52 0-10.6-4.2-10.6-10.2H10c0 6.83 5.44 12.47 12 13.44V42h4v-6.56c6.56-.97 12-6.61 12-13.44h-3.4z",fill:"white"}))),o.a.createElement("button",{onClick:e.toggleVideo,className:"video-button-"+e.video},o.a.createElement("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 50 50",className:"svg"},o.a.createElement("path",{className:"on",d:"M40 8H15.64l8 8H28v4.36l1.13 1.13L36 16v12.36l7.97 7.97L44 36V12c0-2.21-1.79-4-4-4zM4.55 2L2 4.55l4.01 4.01C4.81 9.24 4 10.52 4 12v24c0 2.21 1.79 4 4 4h29.45l4 4L44 41.46 4.55 2zM12 16h1.45L28 30.55V32H12V16z",fill:"white"}),o.a.createElement("path",{className:"off",d:"M40 8H8c-2.21 0-4 1.79-4 4v24c0 2.21 1.79 4 4 4h32c2.21 0 4-1.79 4-4V12c0-2.21-1.79-4-4-4zm-4 24l-8-6.4V32H12V16h16v6.4l8-6.4v16z",fill:"white"}))),o.a.createElement("button",{onClick:R,className:"fullscreen-button"},o.a.createElement("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 50 50",className:"svg"},o.a.createElement("path",{className:"on",d:"M10 32h6v6h4V28H10v4zm6-16h-6v4h10V10h-4v6zm12 22h4v-6h6v-4H28v10zm4-22v-6h-4v10h10v-4h-6z",fill:"white"}),o.a.createElement("path",{className:"off",d:"M14 28h-4v10h10v-4h-6v-6zm-4-8h4v-6h6v-4H10v10zm24 14h-6v4h10V28h-4v6zm-6-24v4h6v6h4V10H28z",fill:"white"}))),o.a.createElement("button",{onClick:e.handleHangup,className:"hangup-button"},o.a.createElement("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 50 50",className:"svg"},o.a.createElement("path",{d:"M24 18c-3.21 0-6.3.5-9.2 1.44v6.21c0 .79-.46 1.47-1.12 1.8-1.95.98-3.74 2.23-5.33 3.7-.36.35-.85.57-1.4.57-.55 0-1.05-.22-1.41-.59L.59 26.18c-.37-.37-.59-.87-.59-1.42 0-.55.22-1.05.59-1.42C6.68 17.55 14.93 14 24 14s17.32 3.55 23.41 9.34c.37.36.59.87.59 1.42 0 .55-.22 1.05-.59 1.41l-4.95 4.95c-.36.36-.86.59-1.41.59-.54 0-1.04-.22-1.4-.57-1.59-1.47-3.38-2.72-5.33-3.7-.66-.33-1.12-1.01-1.12-1.8v-6.21C30.3 18.5 27.21 18 24 18z",fill:"white"})))),o.a.createElement("div",{className:"request-access"},o.a.createElement("p",null,o.a.createElement("span",{className:"you-left"},"Has colgado.\xa0"),"Env\xede una invitaci\xf3n para unirse a la sala."),o.a.createElement("form",{onSubmit:e.send},o.a.createElement("input",{type:"text",autoFocus:!0,onChange:e.handleInput,"data-ref":"message",maxLength:"30",required:!0,placeholder:"Hola, soy Thony"}),o.a.createElement("button",{className:"primary-button"},"Enviar"))),o.a.createElement("div",{className:"grant-access"},o.a.createElement("p",null,"Un compa\xf1ero te ha enviado un mensaje para que te unas a la sala:"),o.a.createElement("div",null,e.message),o.a.createElement("button",{onClick:e.handleInvitation,"data-ref":"reject",className:"primary-button"},"Rechazar"),o.a.createElement("button",{onClick:e.handleInvitation,"data-ref":"accept",className:"primary-button"},"Aceptar")),o.a.createElement("div",{className:"room-occupied"},o.a.createElement("p",null,"\xa1Prueba en otra habitaci\xf3n!"),o.a.createElement(S.a,{className:"primary-button",to:"/"},"OK")),o.a.createElement("div",{className:"waiting"},o.a.createElement("p",null,o.a.createElement("span",null,"Esperando a que alguien se una a esta sala:\xa0"),o.a.createElement("a",{href:window.location.href},window.location.href),o.a.createElement("br",null),o.a.createElement("span",{className:"remote-left"},"Tu colega ha colgado."))))},z=function(e){Object(k.a)(a,e);var t=Object(N.a)(a);function a(e){var n;return Object(E.a)(this,a),(n=t.call(this,e)).state={sid:"",message:"",audio:!0,video:!0},n.handleInvitation=n.handleInvitation.bind(Object(y.a)(n)),n.handleHangup=n.handleHangup.bind(Object(y.a)(n)),n.handleInput=n.handleInput.bind(Object(y.a)(n)),n.toggleVideo=n.toggleVideo.bind(Object(y.a)(n)),n.toggleAudio=n.toggleAudio.bind(Object(y.a)(n)),n.send=n.send.bind(Object(y.a)(n)),n}return Object(w.a)(a,[{key:"hideAuth",value:function(){this.props.media.setState({bridge:"connecting"})}},{key:"full",value:function(){this.props.media.setState({bridge:"full"})}},{key:"componentDidMount",value:function(){var e=this,t=this.props.socket;console.log("props",this.props),this.setState({video:this.props.video,audio:this.props.audio}),t.on("create",(function(){return e.props.media.setState({user:"host",bridge:"create"})})),t.on("full",this.full),t.on("bridge",(function(t){return e.props.media.init()})),t.on("join",(function(){return e.props.media.setState({user:"guest",bridge:"join"})})),t.on("approve",(function(t){var a=t.message,n=t.sid;e.props.media.setState({bridge:"approve"}),e.setState({message:a,sid:n})})),t.emit("find"),this.props.getUserMedia.then((function(t){e.localStream=t,e.localStream.getVideoTracks()[0].enabled=e.state.video,e.localStream.getAudioTracks()[0].enabled=e.state.audio}))}},{key:"handleInput",value:function(e){this.setState(Object(V.a)({},e.target.dataset.ref,e.target.value))}},{key:"send",value:function(e){e.preventDefault(),this.props.socket.emit("auth",this.state),this.hideAuth()}},{key:"handleInvitation",value:function(e){e.preventDefault(),this.props.socket.emit([e.target.dataset.ref],this.state.sid),this.hideAuth()}},{key:"toggleVideo",value:function(){var e=this.localStream.getVideoTracks()[0].enabled=!this.state.video;this.setState({video:e}),this.props.setVideo(e)}},{key:"toggleAudio",value:function(){var e=this.localStream.getAudioTracks()[0].enabled=!this.state.audio;this.setState({audio:e}),this.props.setAudio(e)}},{key:"handleHangup",value:function(){this.props.media.hangup()}},{key:"render",value:function(){return o.a.createElement(T,Object.assign({},this.state,{toggleVideo:this.toggleVideo,toggleAudio:this.toggleAudio,send:this.send,handleHangup:this.handleHangup,handleInput:this.handleInput,handleInvitation:this.handleInvitation}))}}]),a}(o.a.Component),A=Object(s.b)((function(e){return{video:e.video,audio:e.audio}}),(function(e){return{setVideo:function(e){return v.dispatch({type:"SET_VIDEO",video:e})},setAudio:function(e){return v.dispatch({type:"SET_AUDIO",audio:e})}}}))(z),F=a(50),L=a.n(F),U=function(e){Object(k.a)(a,e);var t=Object(N.a)(a);function a(e){var n;return Object(E.a)(this,a),(n=t.call(this,e)).getUserMedia=navigator.mediaDevices.getUserMedia({audio:!0,video:!0}).catch((function(e){return alert("getUserMedia() error: "+e.name)})),n.socket=L.a.connect(),n}return Object(w.a)(a,[{key:"componentDidMount",value:function(){this.props.addRoom()}},{key:"render",value:function(){var e=this;return o.a.createElement("div",null,o.a.createElement(M,{media:function(t){return e.media=t},socket:this.socket,getUserMedia:this.getUserMedia}),o.a.createElement(A,{socket:this.socket,media:this.media,getUserMedia:this.getUserMedia}))}}]),a}(n.Component),q=Object(s.b)((function(e){return{rooms:new Set(Object(r.a)(e.rooms))}}),(function(e,t){return{addRoom:function(){return v.dispatch({type:"ADD_ROOM",room:t.match.params.room})}}}))(U);Boolean("localhost"===window.location.hostname||"[::1]"===window.location.hostname||window.location.hostname.match(/^127(?:\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/));a(98);Object(c.render)(o.a.createElement(s.a,{store:v},o.a.createElement(g.a,null,o.a.createElement(f.a,null,o.a.createElement(b.a,{exact:!0,path:"/",component:x}),o.a.createElement(b.a,{path:"/r/:room",component:q}),o.a.createElement(b.a,{path:"*",component:function(){return o.a.createElement("div",{class:"container user_card mt-5"},o.a.createElement("div",{class:"row"},o.a.createElement("div",{class:"col-md-12 text-center"},o.a.createElement("div",{class:"error-template"},o.a.createElement("h1",null,"Lo sentimos!"),o.a.createElement("h2",null,"404 Pagina no encontrada"),o.a.createElement("div",{class:"error-details"},"Por favor vuelva al inicio del sitio"),o.a.createElement(S.a,{className:"btn btn-primary text-center mt-4",to:"/"},"Inicio")))))}})))),document.getElementById("root")),"serviceWorker"in navigator&&navigator.serviceWorker.ready.then((function(e){e.unregister()})).catch((function(e){console.error(e.message)}))},48:function(e,t,a){e.exports=a.p+"static/media/videollamada.dc2a00d9.webp"},52:function(e,t,a){e.exports=a(100)},93:function(e,t){},98:function(e,t,a){}},[[52,1,2]]]);
//# sourceMappingURL=main.8566c8e6.chunk.js.map